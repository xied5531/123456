---
title: 设计入门：可扩展性
date: 2020-7-12 16:21:49
tags: 系统设计
---

## 克隆

以Web Server为例，通过部署Web Server多实例分担请求，然后通过Load Balancer对外提供服务

关键点：

1. 每一个实例必须包含完全相同的代码，每一个实例不应该存储任何用户相关的数据，无论是本地磁盘还是缓存
2. 用户相关数据，例如Session，需要存储在外部全局缓存服务中，例如Redis，最好用缓存代替数据库
3. 实例的部署升级可以通过灰度发布完成

## 数据库

关系型数据库管理系统（RDBMS）：

> ACID，原子性

- 主从复制，读写分离
- 主主复制，双活
- 分库，按功能划分
- 分表，按范围划分
- SQL优化，字段类型，索引，非规范写法

> 复制的缺点：丢失、延迟

> 分库分表缺点：复杂

NOSQL型：键-值数据库、文档型数据库、列型数据库或图数据库

> BASE，基本可用

- MongoDB等
- 在代码中进行join

适用场景：

- 埋点数据和日志数据
- 排行榜或者得分数据
- 临时数据，如购物车
- 频繁访问的（“热”）表
- 元数据／查找表

## 缓存

> 基于内存而不是基于文件进行缓存

缓存位置：客户端、CDN、Web 服务器、数据库、应用层

应用缓存类型：

- 缓存数据库查询：容易过期
- 缓存对象数据：session、blog、stream等不易变化信息

更新策略：

- 缓存模式：查缓存->查DB->更新缓存；缺点：过期、延迟
- 直写模式：写缓存->同步写DB->返回结果；缺点：慢
- 回写模式：写缓存->异步队列->返回结果->写DB；缺点：丢失
- 刷新模式：从DB刷缓存->读缓存；缺点：实时性，无效

## 异步

模式：

- 提前计算，后台定时更新
- 临时计算，建立异步任务，定时查询任务状态

方法：

- 消息队列：异步消费
- 任务队列：按需调度

背压：限制队列大小

## 参考

- https://www.lecloud.net/tagged/scalability/chrono
- https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md

